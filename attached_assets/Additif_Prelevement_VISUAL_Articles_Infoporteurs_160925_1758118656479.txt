ADDIFIT PRELEVEMENT VISUAL — ARTICLES INFOPORTEURS (v.16/09/2025)
=================================================================

Objet
-----
Intégrer dans les programmes VISUAL le prélèvement **automatique de 30%** par la plateforme
sur **chaque article vendu par un infoporteur** (quel que soit l’acheteur), et rappeler la règle
globale de conversion des VISUpoints (seuil 2 500 pts).

Portée
------
- Concerne UNIQUEMENT les ventes d’articles publiés par les **infoporteurs**.
- Ne modifie pas les règles des investissements porteurs/investisseurs ni les VISUpoints de base.
- Cette règle **remplace** toute mention antérieure selon laquelle l’infoporteur recevrait 100% du prix.

Règle de prélèvement
--------------------
- **PLATEFORME (VISUAL) : 30%** du prix TTC de l’article.
- **INFOPORTEUR : 70%** du prix TTC de l’article.
- Les frais Stripe/banque s’appliquent comme d’ordinaire et sont traités selon la configuration existante.

Constantes (à ajouter au code)
------------------------------
PLATFORM_FEE_INFOARTICLE = 0.30
NET_TO_INFOPORTEUR = 0.70
VISUPOINTS_TO_EUR = 100               # 100 pts = 1 €
VISUPOINTS_CONVERSION_THRESHOLD = 2500 # Seuil conversion/retirable

Logique d’application (pseudo-code)
-----------------------------------
onArticleSaleSuccess(order):
    price_eur = order.total_amount_eur
    platform_cut = round(price_eur * PLATFORM_FEE_INFOARTICLE, 2)
    creator_net = round(price_eur - platform_cut, 2)  # ou price_eur * NET_TO_INFOPORTEUR

    # Enregistrer la répartition
    ledger.record({
        "order_id": order.id,
        "type": "infoarticle_sale_payout",
        "gross": price_eur,
        "platform_fee": platform_cut,
        "creator_net": creator_net,
        "currency": "EUR"
    })

    # Transferts (Stripe Connect / comptes liés)
    stripe.transfer(to="VISUAL_PLATFORM_ACCOUNT", amount=platform_cut, currency="EUR")
    stripe.transfer(to=order.infoporter.stripe_account, amount=creator_net, currency="EUR")

    # Journal d’audit
    audit.log("infoarticle_sale_fee_applied", order.id, {
        "fee_pct": PLATFORM_FEE_INFOARTICLE,
        "platform_fee": platform_cut,
        "creator_net": creator_net
    })

Notes d’intégration
-------------------
1) **Ordre d’opérations** : appliquer le prélèvement (30/70) dès la confirmation du paiement Stripe.
2) **Arrondis** : utiliser un arrondi au centime (2 décimales) pour les écritures comptables.
3) **Conflits** : en cas de divergence avec des règles antérieures, **cette règle fait foi** pour les ventes d’infoarticles.
4) **TOP 10 Infoporteurs/Investi-lecteurs** : ce prélèvement n’empêche pas la redistribution
   éventuelle du “pot commun” selon le module TOP10 ; la base du pot reste définie par les règles en vigueur.
5) **Fiscalité/TVA** : inchangée ; appliquer la configuration fiscale existante (pays/comptes).

Rappel global — VISUpoints convertibles
---------------------------------------
- Quel que soit le profil (visiteur, investisseur, porteur, infoporteur, investi-lecteur) :
  **à partir de 2 500 VISUpoints, les points deviennent convertibles en argent**,
  au taux **100 VISUpoints = 1 €**, sous réserve **KYC validé + compte Stripe lié**.
- Conversion arrondie à l’euro inférieur conformément aux règles globales.

Tests à prévoir
---------------
[ ] Vente infoarticle 10,00 € → plateforme 3,00 € / infoporteur 7,00 € (transferts OK).  
[ ] Vente infoarticle 0,50 € → plateforme 0,15 € / infoporteur 0,35 € (arrondis 2 déc.).  
[ ] Journalisation audit + écritures ledger correctes.  
[ ] Aucune régression sur modules TOP10 et conversion VISUpoints.  

Changelog
---------
- (16/09/2025) Ajout du prélèvement plateforme 30% sur ventes infoporteurs + rappel conversion VISUpoints.
