# VISUpoints_Rules.md

## üìä VISUpoints ‚Äì R√®gles et Formules (Mise √† jour compl√®te au 16/09/2025)

Ce document regroupe toutes les r√®gles concernant les **VISUpoints** pour la plateforme VISUAL Project.  
Il est destin√© √† la fois √† l‚Äô**ADMIN** et √† l‚Äô**IA de g√©n√©ration de code** pour garantir une impl√©mentation coh√©rente.

---

## 1. Bar√®me des VISUpoints (Investisseurs)

| Investissement (‚Ç¨) | VISUpoints gagn√©s |
|---------------------|-------------------|
| 2  | 10  |
| 3  | 15  |
| 4  | 20  |
| 5  | 25  |
| 6  | 30  |
| 8  | 40  |
| 10 | 50  |
| 12 | 60  |
| 15 | 80  |
| 20 | 110 |

üëâ Table de r√©f√©rence unique √† utiliser partout dans la plateforme.

```ts
function investorPoints(eur: 2|3|4|5|6|8|10|12|15|20): number {
  const map: Record<number, number> = {2:10,3:15,4:20,5:25,6:30,8:40,10:50,12:60,15:80,20:110};
  return map[eur];
}
```

---

## 2. Conversion VISUpoints ‚Üî Euros

- **Seuil minimum** : 2 500 VISUpoints.  
- **Taux fixe** : 100 VISUpoints = 1 ‚Ç¨.  
- **Arrondi** : conversion toujours √† l‚Äôeuro inf√©rieur.  
- **Retrait** : uniquement possible si :
  - R√¥le = *Investisseur*,
  - KYC valid√©,
  - Compte Stripe li√©.

```ts
export const VISUPOINTS_TO_EUR = 100;
export const VISUPOINTS_CONVERSION_THRESHOLD = 2500;

function convertibleEuros(points: number): number {
  if (points < VISUPOINTS_CONVERSION_THRESHOLD) return 0;
  return Math.floor(points / VISUPOINTS_TO_EUR);
}
```

---

## 3. Exception de Fid√©lit√© (Visiteur ‚Üí Investisseur)

- Un **visiteur** qui atteint **2 500 VISUpoints** peut **ouvrir un compte investisseur** m√™me sans d√©p√¥t en cash.  
- Ses points ne sont pas convertis automatiquement :
  - Avant KYC/Stripe ‚Üí utilisables en **cr√©dit interne** (non retirable).  
  - Apr√®s KYC/Stripe ‚Üí conversion possible en ‚Ç¨ (25 ‚Ç¨ min).  

```ts
export function canBecomeInvestor(user: UserAccount): boolean {
  const hasCashPath = user.investorCashDepositsEur >= 20;
  const hasPointsPath = user.visupoints >= VISUPOINTS_CONVERSION_THRESHOLD;
  return hasCashPath || hasPointsPath;
}
```

---

## 4. Cr√©dit d‚Äôinvestissement interne

- Optionnel, activable c√¥t√© produit.
- Permet d‚Äôutiliser les VISUpoints comme **cr√©dit interne √©quivalent en ‚Ç¨** (100 pts = 1 ‚Ç¨).
- ‚ùå Jamais retirable en cash, uniquement utilisable pour investir tant que KYC/Stripe ne sont pas valid√©s.

```ts
export function internalInvestingCreditEur(user: UserAccount): number {
  if (user.visupoints < VISUPOINTS_CONVERSION_THRESHOLD) return 0;
  return Math.floor(user.visupoints / VISUPOINTS_TO_EUR);
}
```

---

## 5. VISUpoints Bonus

### a) Mini-ticket ‚ÄúScratch‚Äù
- D√©clench√© tous les **100 VISUpoints cumul√©s**.  
- R√©compenses possibles : {0, 5, 10, 20, 50} points.  
- Probabilit√©s configurables par ADMIN/IA.  
- Valeur implicite : B points = B/100 ‚Ç¨.  
- Journalisation obligatoire par IA (audit).

### b) Bonus Onboarding
- Connexion Stripe : +50 pts (=0,50 ‚Ç¨ implicite).  
- Activation Bunny : +100 pts (=1,00 ‚Ç¨ implicite).  

---

## 6. R√©partition des gains (cat√©gorie cl√¥tur√©e)

- VISUpoints influencent les **votes et classements** (TOP 10).
- Redistribution des gains (apr√®s d√©duction 7% VISUAL) :
  - 40% aux investisseurs TOP 10  
  - 30% aux porteurs TOP 10  
  - 23% aux investisseurs rangs 11‚Äì100  
  - 7% √† VISUAL
- Chaque sortie arrondie √† l‚Äôeuro inf√©rieur (restes ‚Üí VISUAL).

---

## 7. Votes & Classement

### Bar√®me des votes (r√©f√©rence 09/08/25)
| Investissement (‚Ç¨) | Votes attribu√©s |
|---------------------|-----------------|
| 2  | 1 |
| 3  | 2 |
| 4  | 3 |
| 5  | 4 |
| 6  | 5 |
| 8  | 6 |
| 10 | 7 |
| 12 | 8 |
| 15 | 9 |
| 20 | 10 |

```ts
function votesByInvestment(eur: 2|3|4|5|6|8|10|12|15|20): number {
  const map: Record<number, number> = {2:1,3:2,4:3,5:4,6:5,8:6,10:7,12:8,15:9,20:10};
  return map[eur];
}
```

### M√©thode de classement TOP 10
1. **S√©lection** : prendre les 10 projets ayant le plus grand nombre de votes.  
2. **Ordre final** : appliquer le **coefficient d‚Äôengagement** :  

Coefficient(p) = montantTotal(p) √∑ max(1, nbInvestisseurs(p))  

üëâ Classement d√©croissant (plus grand coefficient ‚áí meilleur rang).

---

## 8. Politique d‚Äôarrondis (globale)

- Toute sortie d‚Äôargent (conversion, redistribution, remboursement) est **arrondie √† l‚Äôeuro inf√©rieur**.  
- Les centimes et √©carts restants sont automatiquement affect√©s √† VISUAL.  

---

## 9. R√®gles de conformit√© suppl√©mentaires

- **Anti auto-investissement** : un porteur ne peut pas investir dans son propre projet.  
- **√Çge minimum** : conversion en ‚Ç¨ et retraits r√©serv√©s aux **utilisateurs majeurs** avec KYC valid√©.  

---

## 10. Int√©gration UI/UX

Un hook React `useInvestorUpgradeGate` est fourni pour :
- G√©rer l‚Äôupgrade visiteur ‚Üí investisseur (cash ou points),
- V√©rifier la conversion points ‚Üí ‚Ç¨,
- G√©rer le cr√©dit interne,
- D√©clencher KYC / Stripe.

---

## ‚úÖ R√©sum√© ultra-court (√† coder)

- **VISUpoints** : table investisseurs + seuil 2 500 + 100 pts = 1 ‚Ç¨.  
- **Exception fid√©lit√©** : upgrade investisseur d√®s 2 500 pts.  
- **Bonus** : scratch (100 pts), onboarding (50‚Äì100 pts).  
- **Conversion** : 100 pts = 1 ‚Ç¨, arrondi floor, seuil 2 500, KYC+Stripe requis.  
- **Gains** : 40/30/23/7.  
- **Votes** : table unique + classement en 2 √©tapes (votes + coeff engagement).  
- **Golden Ticket** (optionnel) : 50/75/100 ‚Ç¨ = 20/30/40 votes + remboursements selon rang.  
- **Arrondis** : r√®gle globale, restes ‚Üí VISUAL.  
- **Conformit√©** : anti auto-investissement + majorit√© l√©gale obligatoire.  

---

