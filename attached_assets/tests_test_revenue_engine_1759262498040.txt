from server.revenue.engine import sale_article_split, category_closure_split, euro_floor

def cents(eur): return int(round(eur*100))

def test_sale_article_rounding_and_residual():
    price = cents(9.99)
    plan = sale_article_split(price, "porter", "visual")
    m = {i.role: i.amount_cents for i in plan}
    assert m["porter_sale"] % 100 == 0
    assert m["visual_sale"] + m["porter_sale"] == price

def test_category_split_sum_preserved():
    S = cents(10000)  # 10 000 â‚¬
    inv = [f"inv{i}" for i in range(1,11)]
    port = [f"port{i}" for i in range(1,11)]
    eq = [f"ei{i}" for i in range(11,101)]
    plan = category_closure_split(S, inv, port, eq, "visual")
    total = sum(i.amount_cents for i in plan)
    assert total == S
    visual = [i.amount_cents for i in plan if i.role=="visual_category"][0]
    assert visual >= cents(10000*0.23)

def test_euro_floor():
    assert euro_floor(999) == 900
    assert euro_floor(100) == 100
    assert euro_floor(0) == 0
